<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>My Inventory - Analog Society</title>
    <link rel="stylesheet" href="/styles/main.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
</head>
<body>
    <div class="content-wrapper">
        <%- include('../partials/header') %>

        <main>
            <div class="container" style="padding: 2rem 0;">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 2rem;">
                    <div>
                        <h2>My Analog Inventory</h2>
                        <p class="lead">Manage your documented materials and track your community contributions.</p>
                    </div>
                    <div style="display: flex; gap: 1rem;">
                        <a href="/items/new" class="btn">Add Material</a>
                        <a href="/inventory/export" class="btn btn-secondary">Export Data</a>
                    </div>
                </div>

                <!-- Benefits Overview -->
                <% if (analytics.communityStats && analytics.communityStats.benefits) { %>
                <div class="community-stats" style="margin-bottom: 2rem;">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.5rem;">
                        <h3>Your Analog Society Benefits</h3>
                        <div style="display: flex; align-items: center; gap: 1rem;">
                            <span class="status-badge" style="background: var(--accent-<%= analytics.communityStats.benefits.level.color %>); color: white; padding: 0.5rem 1rem; border-radius: 20px; font-weight: 600;">
                                <%= analytics.communityStats.benefits.level.name %>
                            </span>
                            <span style="color: var(--text-secondary); font-size: 0.9rem;">
                                Benefit Score: <%= analytics.communityStats.benefits.totalValue %>
                            </span>
                        </div>
                    </div>
                    
                    <div class="stats-grid">
                        <% analytics.communityStats.benefits.benefits.forEach(benefit => { %>
                        <div class="stat-card">
                            <div style="color: var(--accent-cool); font-size: 0.8rem; font-weight: 600; text-transform: uppercase; margin-bottom: 0.5rem;">
                                <%= benefit.type %>
                            </div>
                            <div style="font-size: 1.2rem; font-weight: 700; color: var(--text-primary); margin-bottom: 0.5rem;">
                                <%= benefit.title %>
                            </div>
                            <div style="color: var(--text-secondary); font-size: 0.9rem;">
                                <%= benefit.description %>
                            </div>
                            <div style="color: var(--accent-cool); font-size: 0.8rem; font-weight: 600; margin-top: 0.5rem;">
                                +<%= benefit.value %> points
                            </div>
                        </div>
                        <% }); %>
                    </div>
                </div>
                <% } %>

                <!-- Inventory Analytics -->
                <div class="community-stats" style="margin-bottom: 2rem;">
                    <h3>Inventory Analytics</h3>
                    <div class="stats-grid">
                        <div class="stat-card">
                            <div class="stat-number"><%= analytics.totalItems || 0 %></div>
                            <div class="stat-label">Total Items</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-number"><%= analytics.availableItems || 0 %></div>
                            <div class="stat-label">Available</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-card">
                            <div class="stat-number">$<%= (analytics.valueAnalytics?.totalValue || 0).toFixed(0) %></div>
                            <div class="stat-label">Total Value</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-number"><%= analytics.exchangeStats?.completedExchanges || 0 %></div>
                            <div class="stat-label">Completed Exchanges</div>
                        </div>
                    </div>
                </div>

                <!-- Filters and Sorting -->
                <div class="search-filter-section" style="margin-bottom: 2rem;">
                    <form method="GET" style="display: flex; gap: 1rem; align-items: center; flex-wrap: wrap;">
                        <div class="form-group" style="margin-bottom: 0;">
                            <label for="category">Category</label>
                            <select name="category" id="category" class="filter-select">
                                <option value="all" <%= filters.category === 'all' ? 'selected' : '' %>>All Categories</option>
                                <option value="Audio Equipment" <%= filters.category === 'Audio Equipment' ? 'selected' : '' %>>Audio Equipment</option>
                                <option value="Video Equipment" <%= filters.category === 'Video Equipment' ? 'selected' : '' %>>Video Equipment</option>
                                <option value="Photography" <%= filters.category === 'Photography' ? 'selected' : '' %>>Photography</option>
                                <option value="Books" <%= filters.category === 'Books' ? 'selected' : '' %>>Books</option>
                                <option value="Records" <%= filters.category === 'Records' ? 'selected' : '' %>>Records</option>
                                <option value="Tools" <%= filters.category === 'Tools' ? 'selected' : '' %>>Tools</option>
                                <option value="Art" <%= filters.category === 'Art' ? 'selected' : '' %>>Art</option>
                                <option value="Electronics" <%= filters.category === 'Electronics' ? 'selected' : '' %>>Electronics</option>
                                <option value="Crafts" <%= filters.category === 'Crafts' ? 'selected' : '' %>>Crafts</option>
                                <option value="Others" <%= filters.category === 'Others' ? 'selected' : '' %>>Others</option>
                            </select>
                        </div>
                        
                        <div class="form-group" style="margin-bottom: 0;">
                            <label for="status">Status</label>
                            <select name="status" id="status" class="filter-select">
                                <option value="all" <%= filters.status === 'all' ? 'selected' : '' %>>All Status</option>
                                <option value="Available" <%= filters.status === 'Available' ? 'selected' : '' %>>Available</option>
                                <option value="On Loan" <%= filters.status === 'On Loan' ? 'selected' : '' %>>On Loan</option>
                            </select>
                        </div>
                        
                        <div class="form-group" style="margin-bottom: 0;">
                            <label for="sortBy">Sort By</label>
                            <select name="sortBy" id="sortBy" class="filter-select">
                                <option value="createdAt" <%= filters.sortBy === 'createdAt' ? 'selected' : '' %>>Date Added</option>
                                <option value="name" <%= filters.sortBy === 'name' ? 'selected' : '' %>>Name</option>
                                <option value="category" <%= filters.sortBy === 'category' ? 'selected' : '' %>>Category</option>
                                <option value="estimatedValue" <%= filters.sortBy === 'estimatedValue' ? 'selected' : '' %>>Value</option>
                            </select>
                        </div>
                        
                        <div class="form-group" style="margin-bottom: 0;">
                            <label for="sortOrder">Order</label>
                            <select name="sortOrder" id="sortOrder" class="filter-select">
                                <option value="desc" <%= filters.sortOrder === 'desc' ? 'selected' : '' %>>Newest First</option>
                                <option value="asc" <%= filters.sortOrder === 'asc' ? 'selected' : '' %>>Oldest First</option>
                            </select>
                        </div>
                        
                        <button type="submit" class="btn">Apply Filters</button>
                    </form>
                </div>

                <!-- Items Grid -->
                <div class="search-filter-section">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.5rem;">
                        <h3>Your Materials</h3>
                        <span style="color: var(--text-secondary);">
                            <%= items.length %> item<%= items.length !== 1 ? 's' : '' %>
                        </span>
                    </div>
                    
                    <% if (items.length === 0) { %>
                        <div class="no-items">
                            <p>No materials found matching your criteria.</p>
                            <a href="/items/new" class="btn">Add Your First Material</a>
                        </div>
                    <% } else { %>
                        <div class="items-grid">
                            <% items.forEach(item => { %>
                            <div class="item-card">
                                <% if (item.images && item.images.length > 0) { %>
                                <div class="item-image">
                                    <img src="<%= item.images[0] %>" alt="<%= item.name %>">
                                </div>
                                <% } %>
                                
                                <div class="item-info">
                                    <div class="item-name"><%= item.name %></div>
                                    <div class="item-description"><%= item.description %></div>
                                    
                                    <div class="item-meta">
                                        <span class="item-category"><%= item.category %></span>
                                        <span class="item-condition"><%= item.condition %></span>
                                        <% if (item.estimatedValue > 0) { %>
                                        <span class="item-category" style="background: var(--success); color: white;">
                                            $<%= item.estimatedValue.toFixed(0) %>
                                        </span>
                                        <% } %>
                                    </div>
                                    
                                    <div class="item-owner">
                                        <div class="owner-info">
                                            <div class="owner-details">
                                                <div class="owner-name">Trade Type: <%= item.tradeType %></div>
                                                <div class="owner-location">Status: <%= item.availabilityStatus %></div>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <% if (item.provenance && item.provenance.length > 0) { %>
                                    <div style="background: var(--bg-secondary); padding: 0.75rem; border-radius: 6px; margin-bottom: 1rem;">
                                        <div style="font-size: 0.8rem; color: var(--accent-cool); font-weight: 600; margin-bottom: 0.25rem;">
                                            Provenance
                                        </div>
                                        <div style="font-size: 0.9rem; color: var(--text-secondary); line-height: 1.4;">
                                            <%= item.provenance.length > 100 ? item.provenance.substring(0, 100) + '...' : item.provenance %>
                                        </div>
                                    </div>
                                    <% } %>
                                    
                                    <% if (item.technicalDetails && item.technicalDetails.length > 0) { %>
                                    <div style="background: var(--bg-secondary); padding: 0.75rem; border-radius: 6px; margin-bottom: 1rem;">
                                        <div style="font-size: 0.8rem; color: var(--accent-cool); font-weight: 600; margin-bottom: 0.25rem;">
                                            Technical Details
                                        </div>
                                        <div style="font-size: 0.9rem; color: var(--text-secondary); line-height: 1.4;">
                                            <%= item.technicalDetails.length > 100 ? item.technicalDetails.substring(0, 100) + '...' : item.technicalDetails %>
                                        </div>
                                    </div>
                                    <% } %>
                                    
                                    <div class="item-actions">
                                        <a href="/items/<%= item._id %>" class="btn">View Details</a>
                                        <a href="/items/edit/<%= item._id %>" class="btn btn-secondary">Edit</a>
                                    </div>
                                </div>
                            </div>
                            <% }); %>
                        </div>
                    <% } %>
                </div>

                <!-- Category Breakdown -->
                <% if (analytics.categoryBreakdown && analytics.categoryBreakdown.length > 0) { %>
                <div class="search-filter-section" style="margin-top: 2rem;">
                    <h3>Collection Breakdown</h3>
                    <div class="stats-grid">
                        <% analytics.categoryBreakdown.forEach(category => { %>
                        <div class="stat-card">
                            <div class="stat-number"><%= category.count %></div>
                            <div class="stat-label"><%= category._id %></div>
                        </div>
                        <% }); %>
                    </div>
                </div>
                <% } %>

                <!-- Community Engagement -->
                <% if (analytics.communityStats) { %>
                <div class="search-filter-section" style="margin-top: 2rem;">
                    <h3>Community Engagement</h3>
                    <div class="stats-grid">
                        <div class="stat-card">
                            <div class="stat-number"><%= analytics.communityStats.itemsThisMonth || 0 %></div>
                            <div class="stat-label">Items This Month</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-number"><%= analytics.communityStats.totalViews || 0 %></div>
                            <div class="stat-label">Total Views</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-number"><%= analytics.communityStats.knowledgeScore || 0 %></div>
                            <div class="stat-label">Knowledge Score</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-number"><%= analytics.communityStats.reputation || 0 %></div>
                            <div class="stat-label">Reputation</div>
                        </div>
                    </div>
                </div>
                <% } %>
            </div>
        </main>

        <%- include('../partials/footer') %>
    </div>

    <script>
        // Add some interactivity for better UX
        document.addEventListener('DOMContentLoaded', function() {
            // Auto-submit form on filter change
            const filterSelects = document.querySelectorAll('#category, #status, #sortBy, #sortOrder');
            filterSelects.forEach(select => {
                select.addEventListener('change', function() {
                    this.form.submit();
                });
            });

            // Add hover effects to benefit cards
            const benefitCards = document.querySelectorAll('.stat-card');
            benefitCards.forEach(card => {
                card.addEventListener('mouseenter', function() {
                    this.style.transform = 'translateY(-2px)';
                });
                card.addEventListener('mouseleave', function() {
                    this.style.transform = 'translateY(0)';
                });
            });
        });
    </script>
</body>
</html>
